define(function(){function n(n){t&&t(n);for(var r in e)e[r]&&e[r](n)}function r(r){if("onhashchange"in window&&!("_$onhashchange_ignore"in window)){if(window.addEventListener)return window.addEventListener("hashchange",r);window.onhashchange!==n&&(t=window.onhashchange,window.onhashchange=n),e.push(r)}else{var i=window.location,s=i.href,o=i.hash,u=setInterval(function(){var e=i.href,t=i.hash;t!==o&&r({oldURL:s,newURL:e})},100);e.push([r,u])}}function i(t){var n,r;if("onhashchange"in window&&!("_$onhashchange_ignore"in window)){if(window.addEventListener)return window.removeEventListener("hashchange",t);e.splice(e.indexOf(t),1)}else for(var i=0;i<e.length;i++){n=e[i][0],r=e[i][1];if(n===t){clearInterval(r),e.splice(i,1);break}}}function s(){if(e.length===0)return;var t,n=e.slice(0);for(t in n)i(typeof n[t]=="function"?n[t]:n[t][0])}var e=[],t;return{addListener:r,removeListener:i,removeAllListeners:s}});